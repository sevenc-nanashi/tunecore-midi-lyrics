// ==UserScript==
// @name         tunecore-midi-lyrics
// @version      0.1.4
// @author       Nanashi. <https://sevenc7c.com>
// @description  TuneCoreの歌詞登録をMIDIからできるようにするUserscript
// @homepage     https://github.com/sevenc-nanashi/tunecore-midi-lyrics#readme
// @homepageURL  https://github.com/sevenc-nanashi/tunecore-midi-lyrics#readme
// @downloadURL  https://raw.githubusercontent.com/sevenc-nanashi/tunecore-midi-lyrics/built/tunecore-midi-lyrics.user.js
// @updateURL    https://raw.githubusercontent.com/sevenc-nanashi/tunecore-midi-lyrics/built/tunecore-midi-lyrics.user.js
// @match        https://www.tunecore.co.jp/member/release/*
// ==/UserScript==

(function () {
    'use strict';

    let q=Object.getPrototypeOf,re,Te,K,te,ot={isConnected:1},xt=1e3,se,Tt={},_t=q(ot),st=q(q),z,at=(t,r,n,i)=>(t??(i?setTimeout(n,i):queueMicrotask(n),new Set)).add(r),ct=(t,r,n)=>{let i=K;K=r;try{return t(n)}catch(o){return console.error(o),n}finally{K=i;}},fe=t=>t.filter(r=>r._dom?.isConnected),ut=t=>se=at(se,t,()=>{for(let r of se)r._bindings=fe(r._bindings),r._listeners=fe(r._listeners);se=z;},xt),he={get val(){return K?._getters?.add(this),this.rawVal},get oldVal(){return K?._getters?.add(this),this._oldVal},set val(t){K?._setters?.add(this),t!==this.rawVal&&(this.rawVal=t,this._bindings.length+this._listeners.length?(Te?.add(this),re=at(re,this,St)):this._oldVal=t);}},lt=t=>({__proto__:he,rawVal:t,_oldVal:t,_bindings:[],_listeners:[]}),ne=(t,r)=>{let n={_getters:new Set,_setters:new Set},i={f:t},o=te;te=[];let e=ct(t,n,r);e=(e??document).nodeType?e:new Text(e);for(let s of n._getters)n._setters.has(s)||(ut(s),s._bindings.push(i));for(let s of te)s._dom=e;return te=o,i._dom=e},Oe=(t,r=lt(),n)=>{let i={_getters:new Set,_setters:new Set},o={f:t,s:r};o._dom=n??te?.push(o)??ot,r.val=ct(t,i,r.rawVal);for(let e of i._getters)i._setters.has(e)||(ut(e),e._listeners.push(o));return r},ft=(t,...r)=>{for(let n of r.flat(1/0)){let i=q(n??0),o=i===he?ne(()=>n.val):i===st?ne(n):n;o!=z&&t.append(o);}return t},ht=(t,r,...n)=>{let[{is:i,...o},...e]=q(n[0]??0)===_t?n:[{},...n],s=t?document.createElementNS(t,r,{is:i}):document.createElement(r,{is:i});for(let[c,u]of Object.entries(o)){let l=b=>b?Object.getOwnPropertyDescriptor(b,c)??l(q(b)):z,a=r+","+c,d=Tt[a]??=l(q(s))?.set??0,f=c.startsWith("on")?(b,k)=>{let y=c.slice(2);s.removeEventListener(y,k),s.addEventListener(y,b);}:d?d.bind(s):s.setAttribute.bind(s,c),h=q(u??0);c.startsWith("on")||h===st&&(u=Oe(u),h=he),h===he?ne(()=>(f(u.val,u._oldVal),s)):f(u);}return ft(s,e)},Ee=t=>({get:(r,n)=>ht.bind(z,t,n)}),dt=(t,r)=>r?r!==t&&t.replaceWith(r):t.remove(),St=()=>{let t=0,r=[...re].filter(i=>i.rawVal!==i._oldVal);do{Te=new Set;for(let i of new Set(r.flatMap(o=>o._listeners=fe(o._listeners))))Oe(i.f,i.s,i._dom),i._dom=z;}while(++t<100&&(r=[...Te]).length);let n=[...re].filter(i=>i.rawVal!==i._oldVal);re=z;for(let i of new Set(n.flatMap(o=>o._bindings=fe(o._bindings))))dt(i._dom,ne(i.f,i._dom)),i._dom=z;for(let i of n)i._oldVal=i.rawVal;};const pt={tags:new Proxy(t=>new Proxy(ht,Ee(t)),Ee()),hydrate:(t,r)=>dt(t,ne(r,t)),add:ft,state:lt,derive:Oe},ue=t=>t.type==="Failure",Pe=t=>typeof t=="object"&&t!==null&&"then"in t&&typeof t.then=="function"&&"catch"in t&&typeof t.catch=="function",_e=(...t)=>{if(t.length<=0)return {type:"Success"};const r=t[0];return Pe(r)?r.then(n=>({type:"Success",value:n})):{type:"Success",value:r}},D=(...t)=>{if(t.length<=0)return {type:"Failure"};const r=t[0];return Pe(r)?r.then(n=>({type:"Failure",error:n})):{type:"Failure",error:r}},Ne=t=>{const r=(...n)=>{try{const i=t.try(...n);if(Pe(i)){const o=_e(i);return "safe"in t&&t.safe?o:o.catch(e=>D(t.catch(e)))}return _e(i)}catch(i){if("safe"in t&&t.safe)throw i;return D(t.catch(i))}};return "immediate"in t&&t.immediate?r():r},C=Symbol.for("@ts-pattern/matcher"),mt=Symbol.for("@ts-pattern/isVariadic"),de="@ts-pattern/anonymous-select-key",Se=t=>!!(t&&typeof t=="object"),le=t=>t&&!!t[C],T=(t,r,n)=>{if(le(t)){const i=t[C](),{matched:o,selections:e}=i.match(r);return o&&e&&Object.keys(e).forEach(s=>n(s,e[s])),o}if(Se(t)){if(!Se(r))return  false;if(Array.isArray(t)){if(!Array.isArray(r))return  false;let i=[],o=[],e=[];for(const s of t.keys()){const c=t[s];le(c)&&c[mt]?e.push(c):e.length?o.push(c):i.push(c);}if(e.length){if(e.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(r.length<i.length+o.length)return  false;const s=r.slice(0,i.length),c=o.length===0?[]:r.slice(-o.length),u=r.slice(i.length,o.length===0?1/0:-o.length);return i.every((l,a)=>T(l,s[a],n))&&o.every((l,a)=>T(l,c[a],n))&&(e.length===0||T(e[0],u,n))}return t.length===r.length&&t.every((s,c)=>T(s,r[c],n))}return Reflect.ownKeys(t).every(i=>{const o=t[i];return (i in r||le(e=o)&&e[C]().matcherType==="optional")&&T(o,r[i],n);var e;})}return Object.is(r,t)},M=t=>{var r,n,i;return Se(t)?le(t)?(r=(n=(i=t[C]()).getSelectionKeys)==null?void 0:n.call(i))!=null?r:[]:Array.isArray(t)?ie(t,M):ie(Object.values(t),M):[]},ie=(t,r)=>t.reduce((n,i)=>n.concat(r(i)),[]);function Ut(...t){if(t.length===1){const[r]=t;return n=>T(r,n,()=>{})}if(t.length===2){const[r,n]=t;return T(r,n,()=>{})}throw new Error(`isMatching wasn't given the right number of arguments: expected 1 or 2, received ${t.length}.`)}function _(t){return Object.assign(t,{optional:()=>Be(t),and:r=>x(t,r),or:r=>yt(t,r),select:r=>r===void 0?oe(t):oe(r,t)})}function Ue(t){return Object.assign((r=>Object.assign(r,{[Symbol.iterator](){let n=0;const i=[{value:Object.assign(r,{[mt]:true}),done:false},{done:true,value:void 0}];return {next:()=>{var o;return (o=i[n++])!=null?o:i.at(-1)}}}}))(t),{optional:()=>Ue(Be(t)),select:r=>Ue(r===void 0?oe(t):oe(r,t))})}function Be(t){return _({[C]:()=>({match:r=>{let n={};const i=(o,e)=>{n[o]=e;};return r===void 0?(M(t).forEach(o=>i(o,void 0)),{matched:true,selections:n}):{matched:T(t,r,i),selections:n}},getSelectionKeys:()=>M(t),matcherType:"optional"})})}const Mt=(t,r)=>{for(const n of t)if(!r(n))return  false;return  true},Ct=(t,r)=>{for(const[n,i]of t.entries())if(!r(i,n))return  false;return  true},Ft=(t,r)=>{const n=Reflect.ownKeys(t);for(const i of n)if(!r(i,t[i]))return  false;return  true};function x(...t){return _({[C]:()=>({match:r=>{let n={};const i=(o,e)=>{n[o]=e;};return {matched:t.every(o=>T(o,r,i)),selections:n}},getSelectionKeys:()=>ie(t,M),matcherType:"and"})})}function yt(...t){return _({[C]:()=>({match:r=>{let n={};const i=(o,e)=>{n[o]=e;};return ie(t,M).forEach(o=>i(o,void 0)),{matched:t.some(o=>T(o,r,i)),selections:n}},getSelectionKeys:()=>ie(t,M),matcherType:"or"})})}function w(t){return {[C]:()=>({match:r=>({matched:!!t(r)})})}}function oe(...t){const r=typeof t[0]=="string"?t[0]:void 0,n=t.length===2?t[1]:typeof t[0]=="string"?void 0:t[0];return _({[C]:()=>({match:i=>{let o={[r??de]:i};return {matched:n===void 0||T(n,i,(e,s)=>{o[e]=s;}),selections:o}},getSelectionKeys:()=>[r??de].concat(n===void 0?[]:M(n))})})}function gt(t){return  true}function P(t){return typeof t=="number"}function j(t){return typeof t=="string"}function E(t){return typeof t=="bigint"}const bt=_(w(gt)),Ot=_(w(gt)),Pt=bt,A=t=>Object.assign(_(t),{startsWith:r=>{return A(x(t,(n=r,w(i=>j(i)&&i.startsWith(n)))));var n;},endsWith:r=>{return A(x(t,(n=r,w(i=>j(i)&&i.endsWith(n)))));var n;},minLength:r=>A(x(t,(n=>w(i=>j(i)&&i.length>=n))(r))),length:r=>A(x(t,(n=>w(i=>j(i)&&i.length===n))(r))),maxLength:r=>A(x(t,(n=>w(i=>j(i)&&i.length<=n))(r))),includes:r=>{return A(x(t,(n=r,w(i=>j(i)&&i.includes(n)))));var n;},regex:r=>{return A(x(t,(n=r,w(i=>j(i)&&!!i.match(n)))));var n;}}),Ae=A(w(j)),N=t=>Object.assign(_(t),{between:(r,n)=>N(x(t,((i,o)=>w(e=>P(e)&&i<=e&&o>=e))(r,n))),lt:r=>N(x(t,(n=>w(i=>P(i)&&i<n))(r))),gt:r=>N(x(t,(n=>w(i=>P(i)&&i>n))(r))),lte:r=>N(x(t,(n=>w(i=>P(i)&&i<=n))(r))),gte:r=>N(x(t,(n=>w(i=>P(i)&&i>=n))(r))),int:()=>N(x(t,w(r=>P(r)&&Number.isInteger(r)))),finite:()=>N(x(t,w(r=>P(r)&&Number.isFinite(r)))),positive:()=>N(x(t,w(r=>P(r)&&r>0))),negative:()=>N(x(t,w(r=>P(r)&&r<0)))}),Nt=N(w(P)),L=t=>Object.assign(_(t),{between:(r,n)=>L(x(t,((i,o)=>w(e=>E(e)&&i<=e&&o>=e))(r,n))),lt:r=>L(x(t,(n=>w(i=>E(i)&&i<n))(r))),gt:r=>L(x(t,(n=>w(i=>E(i)&&i>n))(r))),lte:r=>L(x(t,(n=>w(i=>E(i)&&i<=n))(r))),gte:r=>L(x(t,(n=>w(i=>E(i)&&i>=n))(r))),positive:()=>L(x(t,w(r=>E(r)&&r>0))),negative:()=>L(x(t,w(r=>E(r)&&r<0)))}),Bt=L(w(E)),jt=_(w(function(t){return typeof t=="boolean"})),Et=_(w(function(t){return typeof t=="symbol"})),At=_(w(function(t){return t==null})),Lt=_(w(function(t){return t!=null}));var G={__proto__:null,matcher:C,optional:Be,array:function(...t){return Ue({[C]:()=>({match:r=>{if(!Array.isArray(r))return {matched:false};if(t.length===0)return {matched:true};const n=t[0];let i={};if(r.length===0)return M(n).forEach(e=>{i[e]=[];}),{matched:true,selections:i};const o=(e,s)=>{i[e]=(i[e]||[]).concat([s]);};return {matched:r.every(e=>T(n,e,o)),selections:i}},getSelectionKeys:()=>t.length===0?[]:M(t[0])})})},set:function(...t){return _({[C]:()=>({match:r=>{if(!(r instanceof Set))return {matched:false};let n={};if(r.size===0)return {matched:true,selections:n};if(t.length===0)return {matched:true};const i=(e,s)=>{n[e]=(n[e]||[]).concat([s]);},o=t[0];return {matched:Mt(r,e=>T(o,e,i)),selections:n}},getSelectionKeys:()=>t.length===0?[]:M(t[0])})})},map:function(...t){return _({[C]:()=>({match:r=>{if(!(r instanceof Map))return {matched:false};let n={};if(r.size===0)return {matched:true,selections:n};const i=(c,u)=>{n[c]=(n[c]||[]).concat([u]);};if(t.length===0)return {matched:true};var o;if(t.length===1)throw new Error(`\`P.map\` wasn't given enough arguments. Expected (key, value), received ${(o=t[0])==null?void 0:o.toString()}`);const[e,s]=t;return {matched:Ct(r,(c,u)=>{const l=T(e,u,i),a=T(s,c,i);return l&&a}),selections:n}},getSelectionKeys:()=>t.length===0?[]:[...M(t[0]),...M(t[1])]})})},record:function(...t){return _({[C]:()=>({match:r=>{if(r===null||typeof r!="object"||Array.isArray(r))return {matched:false};var n;if(t.length===0)throw new Error(`\`P.record\` wasn't given enough arguments. Expected (value) or (key, value), received ${(n=t[0])==null?void 0:n.toString()}`);let i={};const o=(c,u)=>{i[c]=(i[c]||[]).concat([u]);},[e,s]=t.length===1?[Ae,t[0]]:t;return {matched:Ft(r,(c,u)=>{const l=typeof c!="string"||Number.isNaN(Number(c))?null:Number(c),a=l!==null&&T(e,l,o),d=T(e,c,o),f=T(s,u,o);return (d||a)&&f}),selections:i}},getSelectionKeys:()=>t.length===0?[]:[...M(t[0]),...M(t[1])]})})},intersection:x,union:yt,not:function(t){return _({[C]:()=>({match:r=>({matched:!T(t,r,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})})},when:w,select:oe,any:bt,unknown:Ot,_:Pt,string:Ae,number:Nt,bigint:Bt,boolean:jt,symbol:Et,nullish:At,nonNullable:Lt,instanceOf:function(t){return _(w((function(r){return n=>n instanceof r})(t)))},shape:function(t){return _(w(Ut(t)))}};class Dt extends Error{constructor(r){let n;try{n=JSON.stringify(r);}catch{n=r;}super(`Pattern matching error: no pattern matches value ${n}`),this.input=void 0,this.input=r;}}const Me={matched:false,value:void 0};function qt(t){return new pe(t,Me)}class pe{constructor(r,n){this.input=void 0,this.state=void 0,this.input=r,this.state=n;}with(...r){if(this.state.matched)return this;const n=r[r.length-1],i=[r[0]];let o;r.length===3&&typeof r[1]=="function"?o=r[1]:r.length>2&&i.push(...r.slice(1,r.length-1));let e=false,s={};const c=(l,a)=>{e=true,s[l]=a;},u=!i.some(l=>T(l,this.input,c))||o&&!o(this.input)?Me:{matched:true,value:n(e?de in s?s[de]:s:this.input,this.input)};return new pe(this.input,u)}when(r,n){if(this.state.matched)return this;const i=!!r(this.input);return new pe(this.input,i?{matched:true,value:n(this.input,this.input)}:Me)}otherwise(r){return this.state.matched?this.state.value:r(this.input)}exhaustive(r=Vt){return this.state.matched?this.state.value:r(this.input)}run(){return this.exhaustive()}returnType(){return this}narrow(){return this}}function Vt(t){throw new Dt(t)}const O={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},Le={silent:{level:-1},fatal:{level:O.fatal},error:{level:O.error},warn:{level:O.warn},log:{level:O.log},info:{level:O.info},success:{level:O.success},fail:{level:O.fail},ready:{level:O.info},start:{level:O.info},box:{level:O.info},debug:{level:O.debug},trace:{level:O.trace},verbose:{level:O.verbose}};function me(t){if(t===null||typeof t!="object")return  false;const r=Object.getPrototypeOf(t);return r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.iterator in t?false:Symbol.toStringTag in t?Object.prototype.toString.call(t)==="[object Module]":true}function Ce(t,r,n=".",i){if(!me(r))return Ce(t,{},n);const o=Object.assign({},r);for(const e in t){if(e==="__proto__"||e==="constructor")continue;const s=t[e];s!=null&&(Array.isArray(s)&&Array.isArray(o[e])?o[e]=[...s,...o[e]]:me(s)&&me(o[e])?o[e]=Ce(s,o[e],(n?`${n}.`:"")+e.toString()):o[e]=s);}return o}function Rt(t){return (...r)=>r.reduce((n,i)=>Ce(n,i,""),{})}const $t=Rt();function Jt(t){return Object.prototype.toString.call(t)==="[object Object]"}function zt(t){return !(!Jt(t)||!t.message&&!t.args||t.stack)}let ye=false;const De=[];class S{options;_lastLog;_mockFn;constructor(r={}){const n=r.types||Le;this.options=$t({...r,defaults:{...r.defaults},level:ge(r.level,n),reporters:[...r.reporters||[]]},{types:Le,throttle:1e3,throttleMin:5,formatOptions:{date:true,colors:false,compact:true}});for(const i in n){const o={type:i,...this.options.defaults,...n[i]};this[i]=this._wrapLogFn(o),this[i].raw=this._wrapLogFn(o,true);}this.options.mockFn&&this.mockTypes(),this._lastLog={};}get level(){return this.options.level}set level(r){this.options.level=ge(r,this.options.types,this.options.level);}prompt(r,n){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(r,n)}create(r){const n=new S({...this.options,...r});return this._mockFn&&n.mockTypes(this._mockFn),n}withDefaults(r){return this.create({...this.options,defaults:{...this.options.defaults,...r}})}withTag(r){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+r:r})}addReporter(r){return this.options.reporters.push(r),this}removeReporter(r){if(r){const n=this.options.reporters.indexOf(r);if(n!==-1)return this.options.reporters.splice(n,1)}else this.options.reporters.splice(0);return this}setReporters(r){return this.options.reporters=Array.isArray(r)?r:[r],this}wrapAll(){this.wrapConsole(),this.wrapStd();}restoreAll(){this.restoreConsole(),this.restoreStd();}wrapConsole(){for(const r in this.options.types)console["__"+r]||(console["__"+r]=console[r]),console[r]=this[r].raw;}restoreConsole(){for(const r in this.options.types)console["__"+r]&&(console[r]=console["__"+r],delete console["__"+r]);}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log");}_wrapStream(r,n){r&&(r.__write||(r.__write=r.write),r.write=i=>{this[n].raw(String(i).trim());});}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr);}_restoreStream(r){r&&r.__write&&(r.write=r.__write,delete r.__write);}pauseLogs(){ye=true;}resumeLogs(){ye=false;const r=De.splice(0);for(const n of r)n[0]._logFn(n[1],n[2]);}mockTypes(r){const n=r||this.options.mockFn;if(this._mockFn=n,typeof n=="function")for(const i in this.options.types)this[i]=n(i,this.options.types[i])||this[i],this[i].raw=this[i];}_wrapLogFn(r,n){return (...i)=>{if(ye){De.push([this,r,i,n]);return}return this._logFn(r,i,n)}}_logFn(r,n,i){if((r.level||0)>this.level)return  false;const o={date:new Date,args:[],...r,level:ge(r.level,this.options.types)};!i&&n.length===1&&zt(n[0])?Object.assign(o,n[0]):o.args=[...n],o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split(`
`)),o.args.push(`
`+o.additional.join(`
`)),delete o.additional),o.type=typeof o.type=="string"?o.type.toLowerCase():"log",o.tag=typeof o.tag=="string"?o.tag:"";const e=(c=false)=>{const u=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&u>0){const l=[...this._lastLog.object.args];u>1&&l.push(`(repeated ${u} times)`),this._log({...this._lastLog.object,args:l}),this._lastLog.count=1;}c&&(this._lastLog.object=o,this._log(o));};clearTimeout(this._lastLog.timeout);const s=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,s<this.options.throttle)try{const c=JSON.stringify([o.type,o.tag,o.args]),u=this._lastLog.serialized===c;if(this._lastLog.serialized=c,u&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(e,this.options.throttle);return}}catch{}e(true);}_log(r){for(const n of this.options.reporters)n.log(r,{options:this.options});}}function ge(t,r={},n=3){return t===void 0?n:typeof t=="number"?t:r[t]&&r[t].level!==void 0?r[t].level:n}S.prototype.add=S.prototype.addReporter;S.prototype.remove=S.prototype.removeReporter;S.prototype.clear=S.prototype.removeReporter;S.prototype.withScope=S.prototype.withTag;S.prototype.mock=S.prototype.mockTypes;S.prototype.pause=S.prototype.pauseLogs;S.prototype.resume=S.prototype.resumeLogs;function Ht(t={}){return new S(t)}class Kt{options;defaultColor;levelColorMap;typeColorMap;constructor(r){this.options={...r},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"};}_getLogFn(r){return r<1?console.__error||console.error:r===1?console.__warn||console.warn:console.__log||console.log}log(r){const n=this._getLogFn(r.level),i=r.type==="log"?"":r.type,o=r.tag||"",s=`
      background: ${this.typeColorMap[r.type]||this.levelColorMap[r.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,c=`%c${[o,i].filter(Boolean).join(":")}`;typeof r.args[0]=="string"?n(`${c}%c ${r.args[0]}`,s,"",...r.args.slice(1)):n(c,s,...r.args);}}function Wt(t={}){return Ht({reporters:t.reporters||[new Kt({})],prompt(n,i={}){return i.type==="confirm"?Promise.resolve(confirm(n)):Promise.resolve(prompt(n))},...t})}const Gt=Wt(),qe="tcml",Qt=Gt.withTag("TuneCore MIDI Lyrics"),Yt=t=>Qt.withTag(t);function Xt(t,r=document){return Array.from(r.querySelectorAll(t))}function Zt(t,r=document){const n=Xt(t,r);if(n.length===0)throw new Error(`No elements found for selector: ${t}`);return n}function vt(t,r=document){return r.querySelector(t)}function V(t,r=document){const n=vt(t,r);if(!n)throw new Error(`No element found for selector: ${t}`);return n}function er(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var r=t.default;if(typeof r=="function"){var n=function i(){var o=false;try{o=this instanceof i;}catch{}return o?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};n.prototype=r.prototype;}else n={};return Object.defineProperty(n,"__esModule",{value:true}),Object.keys(t).forEach(function(i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,o.get?o:{enumerable:true,get:function(){return t[i]}});}),n}var R={},ae={},be,Ve;function tr(){if(Ve)return be;Ve=1;function t(o){var e=new i(o),s=e.readChunk();if(s.id!="MThd")throw "Bad MIDI file.  Expected 'MHdr', got: '"+s.id+"'";for(var c=r(s.data),u=[],l=0;!e.eof()&&l<c.numTracks;l++){var a=e.readChunk();if(a.id!="MTrk")throw "Bad MIDI file.  Expected 'MTrk', got: '"+a.id+"'";var d=n(a.data);u.push(d);}return {header:c,tracks:u}}function r(o){var e=new i(o),s=e.readUInt16(),c=e.readUInt16(),u={format:s,numTracks:c},l=e.readUInt16();return l&32768?(u.framesPerSecond=256-(l>>8),u.ticksPerFrame=l&255):u.ticksPerBeat=l,u}function n(o){for(var e=new i(o),s=[];!e.eof();){var c=l();s.push(c);}return s;var u;function l(){var a={};a.deltaTime=e.readVarInt();var d=e.readUInt8();if((d&240)===240)if(d===255){a.meta=true;var f=e.readUInt8(),h=e.readVarInt();switch(f){case 0:if(a.type="sequenceNumber",h!==2)throw "Expected length for sequenceNumber event is 2, got "+h;return a.number=e.readUInt16(),a;case 1:return a.type="text",a.text=e.readString(h),a;case 2:return a.type="copyrightNotice",a.text=e.readString(h),a;case 3:return a.type="trackName",a.text=e.readString(h),a;case 4:return a.type="instrumentName",a.text=e.readString(h),a;case 5:return a.type="lyrics",a.text=e.readString(h),a;case 6:return a.type="marker",a.text=e.readString(h),a;case 7:return a.type="cuePoint",a.text=e.readString(h),a;case 32:if(a.type="channelPrefix",h!=1)throw "Expected length for channelPrefix event is 1, got "+h;return a.channel=e.readUInt8(),a;case 33:if(a.type="portPrefix",h!=1)throw "Expected length for portPrefix event is 1, got "+h;return a.port=e.readUInt8(),a;case 47:if(a.type="endOfTrack",h!=0)throw "Expected length for endOfTrack event is 0, got "+h;return a;case 81:if(a.type="setTempo",h!=3)throw "Expected length for setTempo event is 3, got "+h;return a.microsecondsPerBeat=e.readUInt24(),a;case 84:if(a.type="smpteOffset",h!=5)throw "Expected length for smpteOffset event is 5, got "+h;var b=e.readUInt8(),k={0:24,32:25,64:29,96:30};return a.frameRate=k[b&96],a.hour=b&31,a.min=e.readUInt8(),a.sec=e.readUInt8(),a.frame=e.readUInt8(),a.subFrame=e.readUInt8(),a;case 88:if(a.type="timeSignature",h!=2&&h!=4)throw "Expected length for timeSignature event is 4 or 2, got "+h;return a.numerator=e.readUInt8(),a.denominator=1<<e.readUInt8(),h===4?(a.metronome=e.readUInt8(),a.thirtyseconds=e.readUInt8()):(a.metronome=36,a.thirtyseconds=8),a;case 89:if(a.type="keySignature",h!=2)throw "Expected length for keySignature event is 2, got "+h;return a.key=e.readInt8(),a.scale=e.readUInt8(),a;case 127:return a.type="sequencerSpecific",a.data=e.readBytes(h),a;default:return a.type="unknownMeta",a.data=e.readBytes(h),a.metatypeByte=f,a}}else if(d==240){a.type="sysEx";var h=e.readVarInt();return a.data=e.readBytes(h),a}else if(d==247){a.type="endSysEx";var h=e.readVarInt();return a.data=e.readBytes(h),a}else throw "Unrecognised MIDI event type byte: "+d;else {var y;if((d&128)===0){if(u===null)throw "Running status byte encountered before status byte";y=d,d=u,a.running=true;}else y=e.readUInt8(),u=d;var m=d>>4;switch(a.channel=d&15,m){case 8:return a.type="noteOff",a.noteNumber=y,a.velocity=e.readUInt8(),a;case 9:var g=e.readUInt8();return a.type=g===0?"noteOff":"noteOn",a.noteNumber=y,a.velocity=g,g===0&&(a.byte9=true),a;case 10:return a.type="noteAftertouch",a.noteNumber=y,a.amount=e.readUInt8(),a;case 11:return a.type="controller",a.controllerType=y,a.value=e.readUInt8(),a;case 12:return a.type="programChange",a.programNumber=y,a;case 13:return a.type="channelAftertouch",a.amount=y,a;case 14:return a.type="pitchBend",a.value=y+(e.readUInt8()<<7)-8192,a;default:throw "Unrecognised MIDI event type: "+m}}}}function i(o){this.buffer=o,this.bufferLen=this.buffer.length,this.pos=0;}return i.prototype.eof=function(){return this.pos>=this.bufferLen},i.prototype.readUInt8=function(){var o=this.buffer[this.pos];return this.pos+=1,o},i.prototype.readInt8=function(){var o=this.readUInt8();return o&128?o-256:o},i.prototype.readUInt16=function(){var o=this.readUInt8(),e=this.readUInt8();return (o<<8)+e},i.prototype.readInt16=function(){var o=this.readUInt16();return o&32768?o-65536:o},i.prototype.readUInt24=function(){var o=this.readUInt8(),e=this.readUInt8(),s=this.readUInt8();return (o<<16)+(e<<8)+s},i.prototype.readInt24=function(){var o=this.readUInt24();return o&8388608?o-16777216:o},i.prototype.readUInt32=function(){var o=this.readUInt8(),e=this.readUInt8(),s=this.readUInt8(),c=this.readUInt8();return (o<<24)+(e<<16)+(s<<8)+c},i.prototype.readBytes=function(o){var e=this.buffer.slice(this.pos,this.pos+o);return this.pos+=o,e},i.prototype.readString=function(o){var e=this.readBytes(o);return String.fromCharCode.apply(null,e)},i.prototype.readVarInt=function(){for(var o=0;!this.eof();){var e=this.readUInt8();if(e&128)o+=e&127,o<<=7;else return o+e}return o},i.prototype.readChunk=function(){var o=this.readString(4),e=this.readUInt32(),s=this.readBytes(e);return {id:o,length:e,data:s}},be=t,be}var ve,Re;function rr(){if(Re)return ve;Re=1;function t(e,s){if(typeof e!="object")throw "Invalid MIDI data";s=s||{};var c=e.header||{},u=e.tracks||[],l,a=u.length,d=new o;for(r(d,c,a),l=0;l<a;l++)n(d,u[l],s);return d.buffer}function r(e,s,c){var u=s.format==null?1:s.format,l=128;s.timeDivision?l=s.timeDivision:s.ticksPerFrame&&s.framesPerSecond?l=-(s.framesPerSecond&255)<<8|s.ticksPerFrame&255:s.ticksPerBeat&&(l=s.ticksPerBeat&32767);var a=new o;a.writeUInt16(u),a.writeUInt16(c),a.writeUInt16(l),e.writeChunk("MThd",a.buffer);}function n(e,s,c){var u=new o,l,a=s.length,d=null;for(l=0;l<a;l++)(c.running===false||!c.running&&!s[l].running)&&(d=null),d=i(u,s[l],d,c.useByte9ForNoteOff);e.writeChunk("MTrk",u.buffer);}function i(e,s,c,u){var l=s.type,a=s.deltaTime,d=s.text||"",f=s.data||[],h=null;switch(e.writeVarInt(a),l){case "sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(s.number);break;case "text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(d.length),e.writeString(d);break;case "copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(d.length),e.writeString(d);break;case "trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(d.length),e.writeString(d);break;case "instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(d.length),e.writeString(d);break;case "lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(d.length),e.writeString(d);break;case "marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(d.length),e.writeString(d);break;case "cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(d.length),e.writeString(d);break;case "channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(s.channel);break;case "portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(s.port);break;case "endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case "setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(s.microsecondsPerBeat);break;case "smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var b={24:0,25:32,29:64,30:96},k=s.hour&31|b[s.frameRate];e.writeUInt8(k),e.writeUInt8(s.min),e.writeUInt8(s.sec),e.writeUInt8(s.frame),e.writeUInt8(s.subFrame);break;case "timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(s.numerator);var y=Math.floor(Math.log(s.denominator)/Math.LN2)&255;e.writeUInt8(y),e.writeUInt8(s.metronome),e.writeUInt8(s.thirtyseconds||8);break;case "keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(s.key),e.writeUInt8(s.scale);break;case "sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(f.length),e.writeBytes(f);break;case "unknownMeta":s.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(s.metatypeByte),e.writeVarInt(f.length),e.writeBytes(f));break;case "sysEx":e.writeUInt8(240),e.writeVarInt(f.length),e.writeBytes(f);break;case "endSysEx":e.writeUInt8(247),e.writeVarInt(f.length),e.writeBytes(f);break;case "noteOff":var m=u!==false&&s.byte9||u&&s.velocity==0?144:128;h=m|s.channel,h!==c&&e.writeUInt8(h),e.writeUInt8(s.noteNumber),e.writeUInt8(s.velocity);break;case "noteOn":h=144|s.channel,h!==c&&e.writeUInt8(h),e.writeUInt8(s.noteNumber),e.writeUInt8(s.velocity);break;case "noteAftertouch":h=160|s.channel,h!==c&&e.writeUInt8(h),e.writeUInt8(s.noteNumber),e.writeUInt8(s.amount);break;case "controller":h=176|s.channel,h!==c&&e.writeUInt8(h),e.writeUInt8(s.controllerType),e.writeUInt8(s.value);break;case "programChange":h=192|s.channel,h!==c&&e.writeUInt8(h),e.writeUInt8(s.programNumber);break;case "channelAftertouch":h=208|s.channel,h!==c&&e.writeUInt8(h),e.writeUInt8(s.amount);break;case "pitchBend":h=224|s.channel,h!==c&&e.writeUInt8(h);var g=8192+s.value,v=g&127,p=g>>7&127;e.writeUInt8(v),e.writeUInt8(p);break;default:throw "Unrecognized event type: "+l}return h}function o(){this.buffer=[];}return o.prototype.writeUInt8=function(e){this.buffer.push(e&255);},o.prototype.writeInt8=o.prototype.writeUInt8,o.prototype.writeUInt16=function(e){var s=e>>8&255,c=e&255;this.writeUInt8(s),this.writeUInt8(c);},o.prototype.writeInt16=o.prototype.writeUInt16,o.prototype.writeUInt24=function(e){var s=e>>16&255,c=e>>8&255,u=e&255;this.writeUInt8(s),this.writeUInt8(c),this.writeUInt8(u);},o.prototype.writeInt24=o.prototype.writeUInt24,o.prototype.writeUInt32=function(e){var s=e>>24&255,c=e>>16&255,u=e>>8&255,l=e&255;this.writeUInt8(s),this.writeUInt8(c),this.writeUInt8(u),this.writeUInt8(l);},o.prototype.writeInt32=o.prototype.writeUInt32,o.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0));},o.prototype.writeString=function(e){var s,c=e.length,u=[];for(s=0;s<c;s++)u.push(e.codePointAt(s));this.writeBytes(u);},o.prototype.writeVarInt=function(e){if(e<0)throw "Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else {var s=e,c=[];for(c.push(s&127),s>>=7;s;){var u=s&127|128;c.push(u),s>>=7;}this.writeBytes(c.reverse());}},o.prototype.writeChunk=function(e,s){this.writeString(e),this.writeUInt32(s.length),this.writeBytes(s);},ve=t,ve}var $e;function je(){return $e||($e=1,ae.parseMidi=tr(),ae.writeMidi=rr()),ae}var ke={},$={},Je;function kt(){if(Je)return $;Je=1,Object.defineProperty($,"__esModule",{value:true}),$.insert=$.search=void 0;function t(n,i,o){o===void 0&&(o="ticks");var e=0,s=n.length,c=s;if(s>0&&n[s-1][o]<=i)return s-1;for(;e<c;){var u=Math.floor(e+(c-e)/2),l=n[u],a=n[u+1];if(l[o]===i){for(var d=u;d<n.length;d++){var f=n[d];f[o]===i&&(u=d);}return u}else {if(l[o]<i&&a[o]>i)return u;l[o]>i?c=u:l[o]<i&&(e=u+1);}}return  -1}$.search=t;function r(n,i,o){if(o===void 0&&(o="ticks"),n.length){var e=t(n,i[o],o);n.splice(e+1,0,i);}else n.push(i);}return $.insert=r,$}var ze;function Fe(){return ze||(ze=1,(function(t){Object.defineProperty(t,"__esModule",{value:true}),t.Header=t.keySignatureKeys=void 0;var r=kt(),n=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=(function(){function o(e){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),e){n.set(this,e.header.ticksPerBeat),e.tracks.forEach(function(u){u.forEach(function(l){l.meta&&(l.type==="timeSignature"?s.timeSignatures.push({ticks:l.absoluteTime,timeSignature:[l.numerator,l.denominator]}):l.type==="setTempo"?s.tempos.push({bpm:6e7/l.microsecondsPerBeat,ticks:l.absoluteTime}):l.type==="keySignature"&&s.keySignatures.push({key:t.keySignatureKeys[l.key+7],scale:l.scale===0?"major":"minor",ticks:l.absoluteTime}));});});var c=0;e.tracks[0].forEach(function(u){c+=u.deltaTime,u.meta&&(u.type==="trackName"?s.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&s.meta.push({text:u.text,ticks:c,type:u.type}));}),this.update();}}return o.prototype.update=function(){var e=this,s=0,c=0;this.tempos.sort(function(u,l){return u.ticks-l.ticks}),this.tempos.forEach(function(u,l){var a=l>0?e.tempos[l-1].bpm:e.tempos[0].bpm,d=u.ticks/e.ppq-c,f=60/a*d;u.time=f+s,s=u.time,c+=d;}),this.timeSignatures.sort(function(u,l){return u.ticks-l.ticks}),this.timeSignatures.forEach(function(u,l){var a=l>0?e.timeSignatures[l-1]:e.timeSignatures[0],d=(u.ticks-a.ticks)/e.ppq,f=d/a.timeSignature[0]/(a.timeSignature[1]/4);a.measures=a.measures||0,u.measures=f+a.measures;});},o.prototype.ticksToSeconds=function(e){var s=(0, r.search)(this.tempos,e);if(s!==-1){var c=this.tempos[s],u=c.time,l=(e-c.ticks)/this.ppq;return u+60/c.bpm*l}else {var a=e/this.ppq;return 60/120*a}},o.prototype.ticksToMeasures=function(e){var s=(0, r.search)(this.timeSignatures,e);if(s!==-1){var c=this.timeSignatures[s],u=(e-c.ticks)/this.ppq;return c.measures+u/(c.timeSignature[0]/c.timeSignature[1])/4}else return e/this.ppq/4},Object.defineProperty(o.prototype,"ppq",{get:function(){return n.get(this)},enumerable:false,configurable:true}),o.prototype.secondsToTicks=function(e){var s=(0, r.search)(this.tempos,e,"time");if(s!==-1){var c=this.tempos[s],u=c.time,l=e-u,a=l/(60/c.bpm);return Math.round(c.ticks+a*this.ppq)}else {var d=e/.5;return Math.round(d*this.ppq)}},o.prototype.toJSON=function(){return {keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return {bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},o.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(s){return Object.assign({},s)}),this.timeSignatures=e.timeSignatures.map(function(s){return Object.assign({},s)}),this.keySignatures=e.keySignatures.map(function(s){return Object.assign({},s)}),this.meta=e.meta.map(function(s){return Object.assign({},s)}),n.set(this,e.ppq),this.update();},o.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update();},o})();t.Header=i;})(ke)),ke}var Q={},we={},He;function wt(){return He||(He=1,(function(t){Object.defineProperty(t,"__esModule",{value:true}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(o,e){return o[t.controlChangeNames[e]]=e,o},{});var r=new WeakMap,n=new WeakMap,i=(function(){function o(e,s){r.set(this,s),n.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value;}return Object.defineProperty(o.prototype,"number",{get:function(){return n.get(this)},enumerable:false,configurable:true}),Object.defineProperty(o.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:false,configurable:true}),Object.defineProperty(o.prototype,"time",{get:function(){var e=r.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var s=r.get(this);this.ticks=s.secondsToTicks(e);},enumerable:false,configurable:true}),o.prototype.toJSON=function(){return {number:this.number,ticks:this.ticks,time:this.time,value:this.value}},o})();t.ControlChange=i;})(we)),we}var Y={},Ke;function nr(){if(Ke)return Y;Ke=1,Object.defineProperty(Y,"__esModule",{value:true}),Y.createControlChanges=void 0;var t=wt();function r(){return new Proxy({},{get:function(n,i){if(n[i])return n[i];if(t.controlChangeIds.hasOwnProperty(i))return n[t.controlChangeIds[i]]},set:function(n,i,o){return t.controlChangeIds.hasOwnProperty(i)?n[t.controlChangeIds[i]]=o:n[i]=o,true}})}return Y.createControlChanges=r,Y}var X={},We;function ir(){if(We)return X;We=1,Object.defineProperty(X,"__esModule",{value:true}),X.PitchBend=void 0;var t=new WeakMap,r=(function(){function n(i,o){t.set(this,o),this.ticks=i.absoluteTime,this.value=i.value;}return Object.defineProperty(n.prototype,"time",{get:function(){var i=t.get(this);return i.ticksToSeconds(this.ticks)},set:function(i){var o=t.get(this);this.ticks=o.secondsToTicks(i);},enumerable:false,configurable:true}),n.prototype.toJSON=function(){return {ticks:this.ticks,time:this.time,value:this.value}},n})();return X.PitchBend=r,X}var Z={},B={},Ge;function or(){return Ge||(Ge=1,Object.defineProperty(B,"__esModule",{value:true}),B.DrumKitByPatchID=B.InstrumentFamilyByID=B.instrumentByPatchID=void 0,B.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],B.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],B.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),B}var Qe;function sr(){if(Qe)return Z;Qe=1,Object.defineProperty(Z,"__esModule",{value:true}),Z.Instrument=void 0;var t=or(),r=new WeakMap,n=(function(){function i(o,e){if(this.number=0,r.set(this,e),this.number=0,o){var s=o.find(function(c){return c.type==="programChange"});s&&(this.number=s.programNumber);}}return Object.defineProperty(i.prototype,"name",{get:function(){return this.percussion?t.DrumKitByPatchID[this.number]:t.instrumentByPatchID[this.number]},set:function(o){var e=t.instrumentByPatchID.indexOf(o);e!==-1&&(this.number=e);},enumerable:false,configurable:true}),Object.defineProperty(i.prototype,"family",{get:function(){return this.percussion?"drums":t.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:false,configurable:true}),Object.defineProperty(i.prototype,"percussion",{get:function(){var o=r.get(this);return o.channel===9},enumerable:false,configurable:true}),i.prototype.toJSON=function(){return {family:this.family,number:this.number,name:this.name}},i.prototype.fromJSON=function(o){this.number=o.number;},i})();return Z.Instrument=n,Z}var ee={},Ye;function ar(){if(Ye)return ee;Ye=1,Object.defineProperty(ee,"__esModule",{value:true}),ee.Note=void 0;function t(s){var c=Math.floor(s/12)-1;return r(s)+c.toString()}function r(s){var c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],u=s%12;return c[u]}function n(s){var c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return c.indexOf(s)}var i=(function(){var s=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,c={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(u){var l=s.exec(u),a=l[1],d=l[2],f=c[a.toLowerCase()];return f+(parseInt(d,10)+1)*12}})(),o=new WeakMap,e=(function(){function s(c,u,l){o.set(this,l),this.midi=c.midi,this.velocity=c.velocity,this.noteOffVelocity=u.velocity,this.ticks=c.ticks,this.durationTicks=u.ticks-c.ticks;}return Object.defineProperty(s.prototype,"name",{get:function(){return t(this.midi)},set:function(c){this.midi=i(c);},enumerable:false,configurable:true}),Object.defineProperty(s.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(c){var u=c-this.octave;this.midi+=u*12;},enumerable:false,configurable:true}),Object.defineProperty(s.prototype,"pitch",{get:function(){return r(this.midi)},set:function(c){this.midi=12*(this.octave+1)+n(c);},enumerable:false,configurable:true}),Object.defineProperty(s.prototype,"duration",{get:function(){var c=o.get(this);return c.ticksToSeconds(this.ticks+this.durationTicks)-c.ticksToSeconds(this.ticks)},set:function(c){var u=o.get(this),l=u.secondsToTicks(this.time+c);this.durationTicks=l-this.ticks;},enumerable:false,configurable:true}),Object.defineProperty(s.prototype,"time",{get:function(){var c=o.get(this);return c.ticksToSeconds(this.ticks)},set:function(c){var u=o.get(this);this.ticks=u.secondsToTicks(c);},enumerable:false,configurable:true}),Object.defineProperty(s.prototype,"bars",{get:function(){var c=o.get(this);return c.ticksToMeasures(this.ticks)},enumerable:false,configurable:true}),s.prototype.toJSON=function(){return {duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},s})();return ee.Note=e,ee}var Xe;function Ze(){if(Xe)return Q;Xe=1,Object.defineProperty(Q,"__esModule",{value:true}),Q.Track=void 0;var t=kt(),r=wt(),n=nr(),i=ir(),o=sr(),e=ar(),s=new WeakMap,c=(function(){function u(l,a){var d=this;if(this.name="",this.notes=[],this.controlChanges=(0, n.createControlChanges)(),this.pitchBends=[],s.set(this,a),l){var f=l.find(function(p){return p.type==="trackName"});this.name=f?f.text:"";}if(this.instrument=new o.Instrument(l,this),this.channel=0,l){for(var h=l.filter(function(p){return p.type==="noteOn"}),b=l.filter(function(p){return p.type==="noteOff"}),k=function(){var p=h.shift();y.channel=p.channel;var I=b.findIndex(function(H){return H.noteNumber===p.noteNumber&&H.absoluteTime>=p.absoluteTime});if(I!==-1){var U=b.splice(I,1)[0];y.addNote({durationTicks:U.absoluteTime-p.absoluteTime,midi:p.noteNumber,noteOffVelocity:U.velocity/127,ticks:p.absoluteTime,velocity:p.velocity/127});}},y=this;h.length;)k();var m=l.filter(function(p){return p.type==="controller"});m.forEach(function(p){d.addCC({number:p.controllerType,ticks:p.absoluteTime,value:p.value/127});});var g=l.filter(function(p){return p.type==="pitchBend"});g.forEach(function(p){d.addPitchBend({ticks:p.absoluteTime,value:p.value/Math.pow(2,13)});});var v=l.find(function(p){return p.type==="endOfTrack"});this.endOfTrackTicks=v!==void 0?v.absoluteTime:void 0;}}return u.prototype.addNote=function(l){var a=s.get(this),d=new e.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},a);return Object.assign(d,l),(0, t.insert)(this.notes,d,"ticks"),this},u.prototype.addCC=function(l){var a=s.get(this),d=new r.ControlChange({controllerType:l.number},a);return delete l.number,Object.assign(d,l),Array.isArray(this.controlChanges[d.number])||(this.controlChanges[d.number]=[]),(0, t.insert)(this.controlChanges[d.number],d,"ticks"),this},u.prototype.addPitchBend=function(l){var a=s.get(this),d=new i.PitchBend({},a);return Object.assign(d,l),(0, t.insert)(this.pitchBends,d,"ticks"),this},Object.defineProperty(u.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var l=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,a=0;a<this.notes.length-1;a++){var d=this.notes[a].time+this.notes[a].duration;l<d&&(l=d);}return l},enumerable:false,configurable:true}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var l=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,a=0;a<this.notes.length-1;a++){var d=this.notes[a].ticks+this.notes[a].durationTicks;l<d&&(l=d);}return l},enumerable:false,configurable:true}),u.prototype.fromJSON=function(l){var a=this;this.name=l.name,this.channel=l.channel,this.instrument=new o.Instrument(void 0,this),this.instrument.fromJSON(l.instrument),l.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=l.endOfTrackTicks);for(var d in l.controlChanges)l.controlChanges[d]&&l.controlChanges[d].forEach(function(f){a.addCC({number:f.number,ticks:f.ticks,value:f.value});});l.notes.forEach(function(f){a.addNote({durationTicks:f.durationTicks,midi:f.midi,ticks:f.ticks,velocity:f.velocity});});},u.prototype.toJSON=function(){for(var l={},a=0;a<127;a++)this.controlChanges.hasOwnProperty(a)&&(l[a]=this.controlChanges[a].map(function(f){return f.toJSON()}));var d={channel:this.channel,controlChanges:l,pitchBends:this.pitchBends.map(function(f){return f.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(f){return f.toJSON()})};return this.endOfTrackTicks!==void 0&&(d.endOfTrackTicks=this.endOfTrackTicks),d},u})();return Q.Track=c,Q}var J={};function cr(t){var r=[];return It(t,r),r}function It(t,r){for(var n=0;n<t.length;n++){var i=t[n];Array.isArray(i)?It(i,r):r.push(i);}}const ur=Object.freeze(Object.defineProperty({__proto__:null,flatten:cr},Symbol.toStringTag,{value:"Module"})),lr=er(ur);var et;function fr(){if(et)return J;et=1;var t=J&&J.__spreadArray||function(m,g,v){if(v||arguments.length===2)for(var p=0,I=g.length,U;p<I;p++)(U||!(p in g))&&(U||(U=Array.prototype.slice.call(g,0,p)),U[p]=g[p]);return m.concat(U||Array.prototype.slice.call(g))};Object.defineProperty(J,"__esModule",{value:true}),J.encode=void 0;var r=je(),n=Fe(),i=lr;function o(m,g){return [{absoluteTime:m.ticks,channel:g,deltaTime:0,noteNumber:m.midi,type:"noteOn",velocity:Math.floor(m.velocity*127)},{absoluteTime:m.ticks+m.durationTicks,channel:g,deltaTime:0,noteNumber:m.midi,type:"noteOff",velocity:Math.floor(m.noteOffVelocity*127)}]}function e(m){return (0, i.flatten)(m.notes.map(function(g){return o(g,m.channel)}))}function s(m,g){return {absoluteTime:m.ticks,channel:g,controllerType:m.number,deltaTime:0,type:"controller",value:Math.floor(m.value*127)}}function c(m){for(var g=[],v=0;v<127;v++)m.controlChanges.hasOwnProperty(v)&&m.controlChanges[v].forEach(function(p){g.push(s(p,m.channel));});return g}function u(m,g){return {absoluteTime:m.ticks,channel:g,deltaTime:0,type:"pitchBend",value:m.value}}function l(m){var g=[];return m.pitchBends.forEach(function(v){g.push(u(v,m.channel));}),g}function a(m){return {absoluteTime:0,channel:m.channel,deltaTime:0,programNumber:m.instrument.number,type:"programChange"}}function d(m){return {absoluteTime:0,deltaTime:0,meta:true,text:m,type:"trackName"}}function f(m){return {absoluteTime:m.ticks,deltaTime:0,meta:true,microsecondsPerBeat:Math.floor(6e7/m.bpm),type:"setTempo"}}function h(m){return {absoluteTime:m.ticks,deltaTime:0,denominator:m.timeSignature[1],meta:true,metronome:24,numerator:m.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function b(m){var g=n.keySignatureKeys.indexOf(m.key);return {absoluteTime:m.ticks,deltaTime:0,key:g+7,meta:true,scale:m.scale==="major"?0:1,type:"keySignature"}}function k(m){return {absoluteTime:m.ticks,deltaTime:0,meta:true,text:m.text,type:m.type}}function y(m){var g={header:{format:1,numTracks:m.tracks.length+1,ticksPerBeat:m.header.ppq},tracks:t([t(t(t(t([{absoluteTime:0,deltaTime:0,meta:true,text:m.header.name,type:"trackName"}],m.header.keySignatures.map(function(v){return b(v)}),true),m.header.meta.map(function(v){return k(v)}),true),m.header.tempos.map(function(v){return f(v)}),true),m.header.timeSignatures.map(function(v){return h(v)}),true)],m.tracks.map(function(v){return t(t(t([d(v.name),a(v)],e(v),true),c(v),true),l(v),true)}),true)};return g.tracks=g.tracks.map(function(v){v=v.sort(function(I,U){return I.absoluteTime-U.absoluteTime});var p=0;return v.forEach(function(I){I.deltaTime=I.absoluteTime-p,p=I.absoluteTime,delete I.absoluteTime;}),v.push({deltaTime:0,meta:true,type:"endOfTrack"}),v}),new Uint8Array((0, r.writeMidi)(g))}return J.encode=y,J}var tt;function hr(){return tt||(tt=1,(function(t){var r=R&&R.__awaiter||function(d,f,h,b){function k(y){return y instanceof h?y:new h(function(m){m(y);})}return new(h||(h=Promise))(function(y,m){function g(I){try{p(b.next(I));}catch(U){m(U);}}function v(I){try{p(b.throw(I));}catch(U){m(U);}}function p(I){I.done?y(I.value):k(I.value).then(g,v);}p((b=b.apply(d,f||[])).next());})},n=R&&R.__generator||function(d,f){var h={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},b,k,y,m;return m={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function g(p){return function(I){return v([p,I])}}function v(p){if(b)throw new TypeError("Generator is already executing.");for(;h;)try{if(b=1,k&&(y=p[0]&2?k.return:p[0]?k.throw||((y=k.return)&&y.call(k),0):k.next)&&!(y=y.call(k,p[1])).done)return y;switch(k=0,y&&(p=[p[0]&2,y.value]),p[0]){case 0:case 1:y=p;break;case 4:return h.label++,{value:p[1],done:!1};case 5:h.label++,k=p[1],p=[0];continue;case 7:p=h.ops.pop(),h.trys.pop();continue;default:if(y=h.trys,!(y=y.length>0&&y[y.length-1])&&(p[0]===6||p[0]===2)){h=0;continue}if(p[0]===3&&(!y||p[1]>y[0]&&p[1]<y[3])){h.label=p[1];break}if(p[0]===6&&h.label<y[1]){h.label=y[1],y=p;break}if(y&&h.label<y[2]){h.label=y[2],h.ops.push(p);break}y[2]&&h.ops.pop(),h.trys.pop();continue}p=f.call(d,h);}catch(I){p=[6,I],k=0;}finally{b=y=0;}if(p[0]&5)throw p[1];return {value:p[0]?p[1]:void 0,done:true}}};Object.defineProperty(t,"__esModule",{value:true}),t.Header=t.Track=t.Midi=void 0;var i=je(),o=Fe(),e=Ze(),s=fr(),c=(function(){function d(f){var h=this,b=null;if(f){var k=f instanceof ArrayBuffer?new Uint8Array(f):f;b=(0, i.parseMidi)(k),b.tracks.forEach(function(y){var m=0;y.forEach(function(g){m+=g.deltaTime,g.absoluteTime=m;});}),b.tracks=a(b.tracks);}this.header=new o.Header(b),this.tracks=[],f&&(this.tracks=b.tracks.map(function(y){return new e.Track(y,h.header)}),b.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift());}return d.fromUrl=function(f){return r(this,void 0,void 0,function(){var h,b;return n(this,function(k){switch(k.label){case 0:return [4,fetch(f)];case 1:return h=k.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return b=k.sent(),[2,new d(b)];case 3:throw new Error("Could not load '".concat(f,"'"))}})})},Object.defineProperty(d.prototype,"name",{get:function(){return this.header.name},set:function(f){this.header.name=f;},enumerable:false,configurable:true}),Object.defineProperty(d.prototype,"duration",{get:function(){var f=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,f)},enumerable:false,configurable:true}),Object.defineProperty(d.prototype,"durationTicks",{get:function(){var f=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,f)},enumerable:false,configurable:true}),d.prototype.addTrack=function(){var f=new e.Track(void 0,this.header);return this.tracks.push(f),f},d.prototype.toArray=function(){return (0, s.encode)(this)},d.prototype.toJSON=function(){return {header:this.header.toJSON(),tracks:this.tracks.map(function(f){return f.toJSON()})}},d.prototype.fromJSON=function(f){var h=this;this.header=new o.Header,this.header.fromJSON(f.header),this.tracks=f.tracks.map(function(b){var k=new e.Track(void 0,h.header);return k.fromJSON(b),k});},d.prototype.clone=function(){var f=new d;return f.fromJSON(this.toJSON()),f},d})();t.Midi=c;var u=Ze();Object.defineProperty(t,"Track",{enumerable:true,get:function(){return u.Track}});var l=Fe();Object.defineProperty(t,"Header",{enumerable:true,get:function(){return l.Header}});function a(d){for(var f=[],h=0;h<d.length;h++)for(var b=f.length,k=new Map,y=Array(16).fill(0),m=0,g=d[h];m<g.length;m++){var v=g[m],p=b,I=v.channel;if(I!==void 0){v.type==="programChange"&&(y[I]=v.programNumber);var U=y[I],H="".concat(U," ").concat(I);k.has(H)?p=k.get(H):(p=b+k.size,k.set(H,p));}f[p]||f.push([]),f[p].push(v);}return f}})(R)),R}var dr=hr(),pr=je();const rt=.001,mr=Ne({try:t=>new dr.Midi(t),catch:t=>({type:"parseError",message:String(t)})}),yr=Ne({try:t=>pr.parseMidi(t),catch:t=>({type:"parseError",message:String(t)})}),gr=Ne({try:t=>new TextDecoder().decode(new Uint8Array(t.split("").map(r=>r.charCodeAt(0)))),catch:t=>({type:"invalidTextEncoding",message:String(t)})});function br(t){const r=mr(t);if(ue(r))return D(r.error);const n=r.value,i=yr(t);if(ue(i))return D(i.error);const o=i.value,e=[],s=[];for(const f of o.tracks){let h=0;for(const b of f)if(h+=b.deltaTime,b.type==="text"){const k=gr(b.text);ue(k)?s.push(h):e.push({tick:h,text:k.value});}}if(s.length>0)return D({type:"invalidTextEncoding",positions:s.map(f=>ce(n.header,f))});const c=n.tracks.flatMap(f=>f.notes);c.sort((f,h)=>f.ticks-h.ticks);const u=[],l=new Set;for(let f=0;f<c.length-1;f++)c[f].ticks+c[f].durationTicks>c[f+1].ticks&&l.add(c[f+1].ticks);if(l.size>0)return D({type:"overlappingNotes",positions:Array.from(l).map(f=>ce(n.header,f))});const a=[],d=new Set(c.map(f=>f.ticks));for(const f of e){const h=c.find(b=>b.ticks===f.tick);h?(u.push({time:h.time,text:f.text,midi:h.midi}),u.push({time:h.time+h.duration,text:"",midi:h.midi}),d.delete(f.tick)):a.push(f.tick);}if(a.length>0)return D({type:"noNote",positions:a.map(f=>ce(n.header,f))});if(d.size>e.length)return D({type:"excessiveTextEvents",positions:Array.from(d).map(f=>ce(n.header,f))});u.sort((f,h)=>f.time!==h.time?f.time-h.time:f.text.length-h.text.length);for(let f=u.length-2;f>=0;f--)u[f].text===""&&u[f].time===u[f+1].time&&u[f].midi===u[f+1].midi&&u.splice(f,1);for(let f=0;f<u.length-1;f++)u[f].time+rt<u[f+1].time||(u[f+1].time=u[f].time+rt);return u.splice(u.length-1,1),_e(u.map(f=>({time:f.time,text:f.text})))}function ce(t,r){if(r<0)throw new Error("Ticks cannot be negative");let n=0;const i=t.timeSignatures;for(let o=0;o<i.length;o++){const e={ticks:i[o].ticks,numerator:i[o].timeSignature[0],denominator:i[o].timeSignature[1]},s=i[o+1],c=t.ppq*4*e.numerator/e.denominator;for(let u=e.ticks;u<(s?s.ticks:1/0);u+=c){if(r<u+c){const l=r-u,a=Math.floor(l/t.ppq%e.numerator)+1,d=l%t.ppq;return {measure:n,beat:a,tick:d}}n++;}}throw new Error("Could not convert ticks to position")}const F=Yt("index"),{div:Ie,h5:vr,p:nt,button:kr,a:xe,span:wr,input:Ir}=pt.tags,W=pt.state(0),it=["listening to my music on TuneCore <3: https://www.tunecore.co.jp/artists/sevenc-nanashi","retweeting the announcement tweet <3: https://twitter.com/sevenc_nanashi/status/2000356981786415487"];function xr(){const t=vt(`#lyrics_line_sync:not([data-${qe}-injected="true"])`);if(!t)return;F.info("Injecting MIDI lyrics form");const r=V(".caution",t),n=Ie({class:"tcml-container"},vr({class:"tcml-title",style:"font-size: 110%;margin-bottom: 5px"},"MIDIから読み込む",wr({style:"font-size: 80%; margin-left: 1rem; color: #8e8e8e"},xe({target:"_blank",href:"https://github.com/sevenc-nanashi/tunecore-midi-lyrics"},"TuneCore MIDI Lyrics")," by ",xe({target:"_blank",href:"https://www.tunecore.co.jp/artists/sevenc-nanashi",style:"color: #48b0d5"},"Nanashi."))),nt({style:"margin-bottom: 5px; font-size: 80%"},"MIDIの歌詞情報を読み込み、歌詞入力欄に反映します。"),Ie({style:"display: flex; align-items: center"},Ie({style:"display: flex; align-items: center"},nt({style:"font-size: 80%; cursor: help",title:"MIDI内のタイミングを早めます。"},"開始時間（秒）："),Ir({type:"number",class:"form-control",value:()=>W.val,step:"any",style:"width: 5rem; margin-left: 5px; margin-right: 10px",onchange:o=>{const e=o.target,s=Number(e.value);W.val=isNaN(s)?0:s;}},[])),kr({class:"btn btn-default",type:"button",onclick:Tr},"MIDIを開く"),xe({target:"_blank",href:"https://github.com/sevenc-nanashi/tunecore-midi-lyrics#usage",style:"margin-left: 10px; font-size: 80%"},"使い方"))),i=r.parentElement;if(!i)throw new Error("Caution element has no parent");i.insertBefore(n,r.nextElementSibling),t.dataset[qe+"Injected"]="true";}async function Tr(){F.info("Loading MIDI file");const t=await Cr();if(!t){F.warn("No MIDI file selected");return}const r=br(t);if(ue(r)){F.error("Failed to parse MIDI file",r.error),alert(`MIDIを読み込めませんでした。
${qt(r.error).with({type:"parseError",message:G.string},({message:o})=>`MIDIファイルを解析できませんでした：${o}`).with({type:"invalidTextEncoding",positions:G.array()},({positions:o})=>`MIDIの歌詞を正しくデコードできませんでした。
位置：${o.map(e=>`${e.measure}.${e.beat}.${e.tick}`).join("、")}`).with({type:"noNote",positions:G.array()},({positions:o})=>`MIDIの歌詞に対応するノートが見つかりませんでした。
位置：${o.map(e=>`${e.measure}.${e.beat}.${e.tick}`).join("、")}`).with({type:"excessiveTextEvents",positions:G.array()},({positions:o})=>`MIDIの歌詞に対応していないノートが存在します。
位置：${o.map(e=>`${e.measure}.${e.beat}.${e.tick}`).join("、")}`).with({type:"overlappingNotes",positions:G.array()},({positions:o})=>`ノートが重なっています。
位置：${o.map(e=>`${e.measure}.${e.beat}.${e.tick}`).join("、")}`).exhaustive()}`);return}const n=r.value;if(n[0].time<W.val){F.warn(`Lyrics start time (${n[0].time}) is before offset (${W.val})`),alert(`MIDIの歌詞の開始時間（${n[0].time}秒）が、指定したオフセット時間（${W.val}秒）より前です。オフセット時間を見直してください。`);return}const i=1500;if(n.length>i){if(!confirm(`MIDIの歌詞数が多すぎます（${n.length}個）。先頭の${i}個のみを読み込みます。続行しますか？`)){F.info("User cancelled loading due to excessive lyrics");return}n.splice(i);}else F.info(`Parsed ${n.length} lyric events from MIDI`);_r(),Sr(r),Ur(n),Mr(),F.success("MIDI lyrics loaded successfully"),F.success(`[AD] If you find this tool useful, consider ${it[Math.floor(Math.random()*it.length)]}`);}function _r(){F.info("Clearing existing lyrics");const t=Zt(".lyrics_row");for(const r of t){const n=V(".remove_row_button",r);V(".start-time",r).textContent.trim()!==""&&n.click();}}function Sr(t){const r=V("textarea.lyrics-text"),n=t.value.map(o=>o.text);r.value=n.join(`
`);const i=new Event("input",{bubbles:true});r.dispatchEvent(i),F.info("Lyrics loaded into textarea");}function Ur(t){const r=V(".operation-button-wrapper audio"),n=V(".audio_control_container .set-button");n.removeAttribute("disabled");for(const[i,o]of t.entries()){const e=o.time-W.val;r.currentTime=e,V(`.lyrics_row[data-row_num="${i+1}"]`).click(),n.click();}r.currentTime=0,n.setAttribute("disabled","true"),F.info("Lyrics timing set");}function Mr(){const t=V('[name="preview_flag"]'),r=t.checked?2:1;for(let n=0;n<r;n++)t.click();F.info("Preview toggled");}async function Cr(){return new Promise(t=>{const r=document.createElement("input");r.type="file",r.accept=".mid,.midi",r.style.display="none",r.addEventListener("change",()=>{const n=r.files?.[0];if(!n){t(null);return}const i=new FileReader;i.onload=()=>{const o=i.result;o instanceof ArrayBuffer?t(new Uint8Array(o)):t(null);},i.readAsArrayBuffer(n);}),document.body.appendChild(r),r.click(),document.body.removeChild(r);})}async function Fr(){F.info("Script started"),setInterval(()=>{xr();},1e3);}Fr();

})();